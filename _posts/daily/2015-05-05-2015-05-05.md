---
title: 2015-05-05 工作日志
category: daily
tags: ['daily']
---

## 工作番茄数
- 上午修复了因panel 修改而造成的客户端设置的一些bug；
- 上午重构了toolbar 部分；
- 下午开始编写file 的整个架构，想法大概有，但不确定是不是好的想法，所以，也是在摸索着写吧；
- 进度大概就是写到视图间事件传递吧；

## 工作预设
- 确定好file 模块的架构；
- 完成视图切换；
- 完成往来附件模块的重构；

## 工作随笔
file 模块加载时，render 当前的子视图，当切换视图时，off 所有与当前子视图关联的事件（这里只包括模块Pub 的事件），并通知当前子视图off 所有与模块关联的事件（这里只包括子视图Pub 的事件），然后render 新子视图；

render 子视图时，默认进行无条件、无筛选下的初始化，但需要把列表mode 以及parentNode 传给子视图；
当模块的组件，比如筛选、分页、搜索、mode切换等触发时，file 模块先进行事件的第一步处理，将正确的处理结果以Pub 事件的方式传给当前子视图，并由子视图根据结果渲染列表；


子视图抽象出一个方法1，作用是，根据数据库传入的条目总数，Pub 事件通知file 模块更新分页；

子视图抽象出一个方法2，作用是，根据数据库传入的数据，缓存起来，并渲染出列表内容；

子视图抽象出一个方法3，调用情景是列表内容有变化，比如mode 切换、筛选、搜索等，作用是根据数据库传入的条目总数以及数据，调用上面两个方法（1、2）。

子视图render 的时候，默认是无条件的初始化，根据传入的mode 以及自身设置的分页数限制，从数据库获取数据值以及条目总数，执行方法3。

数据缓存逻辑：

当列表条件稳定的情况下，把从数据库获取的数据按分页索引保存到缓存中；

当列表条件变化时，更新缓存；
